{"ast":null,"code":"import _slicedToArray from\"C:/Users/kaust/OneDrive/Desktop/domingo/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useState,useRef,useEffect}from\"react\";import{io}from\"socket.io-client\";import Peer from\"simple-peer\";import{jsx as _jsx}from\"react/jsx-runtime\";var SocketContext=/*#__PURE__*/createContext();var socket=io(\"https://domingo-web-app.herokuapp.com\");var ContextProvider=function ContextProvider(_ref){var children=_ref.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),callAccepted=_useState2[0],setCallAccepted=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),callEnded=_useState4[0],setCallEnded=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),stream=_useState6[0],setStream=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),name=_useState8[0],setName=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),call=_useState10[0],setCall=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),me=_useState12[0],setMe=_useState12[1];var myVideo=useRef();var userVideo=useRef();var connectionRef=useRef();useEffect(function(){navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(currentStream){setStream(currentStream);myVideo.current.srcObject=currentStream;});socket.on(\"me\",function(id){return setMe(id);});socket.on(\"callUser\",function(_ref2){var from=_ref2.from,callerName=_ref2.name,signal=_ref2.signal;setCall({isReceivingCall:true,from:from,name:callerName,signal:signal});});},[]);var answerCall=function answerCall(){setCallAccepted(true);var peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on(\"signal\",function(data){socket.emit(\"answerCall\",{signal:data,to:call.from});});peer.on(\"stream\",function(currentStream){userVideo.current.srcObject=currentStream;});peer.signal(call.signal);connectionRef.current=peer;};var callUser=function callUser(id){var peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on(\"signal\",function(data){socket.emit(\"callUser\",{userToCall:id,signalData:data,from:me,name:name});});peer.on(\"stream\",function(currentStream){userVideo.current.srcObject=currentStream;});socket.on(\"callAccepted\",function(signal){setCallAccepted(true);peer.signal(signal);});connectionRef.current=peer;};var leaveCall=function leaveCall(){setCallEnded(true);connectionRef.current.destroy();window.location.reload();};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:{call:call,callAccepted:callAccepted,myVideo:myVideo,userVideo:userVideo,stream:stream,name:name,setName:setName,callEnded:callEnded,me:me,callUser:callUser,leaveCall:leaveCall,answerCall:answerCall},children:children});};export{ContextProvider,SocketContext};","map":{"version":3,"sources":["C:/Users/kaust/OneDrive/Desktop/domingo/client/src/SocketContext.js"],"names":["React","createContext","useState","useRef","useEffect","io","Peer","SocketContext","socket","ContextProvider","children","callAccepted","setCallAccepted","callEnded","setCallEnded","stream","setStream","name","setName","call","setCall","me","setMe","myVideo","userVideo","connectionRef","navigator","mediaDevices","getUserMedia","video","audio","then","currentStream","current","srcObject","on","id","from","callerName","signal","isReceivingCall","answerCall","peer","initiator","trickle","data","emit","to","callUser","userToCall","signalData","leaveCall","destroy","window","location","reload"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useRef, useEffect } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport Peer from \"simple-peer\";\r\n\r\nconst SocketContext = createContext();\r\nconst socket = io(\"https://domingo-web-app.herokuapp.com\");\r\n\r\nconst ContextProvider = ({ children }) => {\r\n  const [callAccepted, setCallAccepted] = useState(false);\r\n  const [callEnded, setCallEnded] = useState(false);\r\n  const [stream, setStream] = useState();\r\n  const [name, setName] = useState(\"\");\r\n  const [call, setCall] = useState({});\r\n  const [me, setMe] = useState(\"\");\r\n\r\n  const myVideo = useRef();\r\n  const userVideo = useRef();\r\n  const connectionRef = useRef();\r\n\r\n  useEffect(() => {\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: true, audio: true })\r\n      .then(currentStream => {\r\n        setStream(currentStream);\r\n\r\n        myVideo.current.srcObject = currentStream;\r\n      });\r\n\r\n    socket.on(\"me\", id => setMe(id));\r\n\r\n    socket.on(\"callUser\", ({ from, name: callerName, signal }) => {\r\n      setCall({ isReceivingCall: true, from, name: callerName, signal });\r\n    });\r\n  }, []);\r\n\r\n  const answerCall = () => {\r\n    setCallAccepted(true);\r\n\r\n    const peer = new Peer({ initiator: false, trickle: false, stream });\r\n\r\n    peer.on(\"signal\", data => {\r\n      socket.emit(\"answerCall\", { signal: data, to: call.from });\r\n    });\r\n\r\n    peer.on(\"stream\", currentStream => {\r\n      userVideo.current.srcObject = currentStream;\r\n    });\r\n\r\n    peer.signal(call.signal);\r\n\r\n    connectionRef.current = peer;\r\n  };\r\n\r\n  const callUser = id => {\r\n    const peer = new Peer({ initiator: true, trickle: false, stream });\r\n\r\n    peer.on(\"signal\", data => {\r\n      socket.emit(\"callUser\", {\r\n        userToCall: id,\r\n        signalData: data,\r\n        from: me,\r\n        name,\r\n      });\r\n    });\r\n\r\n    peer.on(\"stream\", currentStream => {\r\n      userVideo.current.srcObject = currentStream;\r\n    });\r\n\r\n    socket.on(\"callAccepted\", signal => {\r\n      setCallAccepted(true);\r\n\r\n      peer.signal(signal);\r\n    });\r\n\r\n    connectionRef.current = peer;\r\n  };\r\n\r\n  const leaveCall = () => {\r\n    setCallEnded(true);\r\n\r\n    connectionRef.current.destroy();\r\n\r\n    window.location.reload();\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider\r\n      value={{\r\n        call,\r\n        callAccepted,\r\n        myVideo,\r\n        userVideo,\r\n        stream,\r\n        name,\r\n        setName,\r\n        callEnded,\r\n        me,\r\n        callUser,\r\n        leaveCall,\r\n        answerCall,\r\n      }}\r\n    >\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n\r\nexport { ContextProvider, SocketContext };\r\n"]},"metadata":{},"sourceType":"module"}